<!doctype html>
<html>
<head>
  <script src="http://d3js.org/d3.v3.min.js" charset="utf-8"></script>
  <script src="http://code.jquery.com/jquery-latest.min.js"></script>
  <script src="d3-timeline.js"></script>

  <style type="text/css">
    .axis path,
    .axis line {
      fill: none;
      stroke: black;
      shape-rendering: crispEdges;
    }

    .axis text {
      font-family: sans-serif;
      font-size: 10px;
    }

    .timeline-label {
      font-family: sans-serif;
      font-size: 12px;
    }
    
    .coloredDiv {
      height:20px; width:20px; float:left;
    }
  </style>

  <script type="text/javascript">
    //Plug this into whatever page is supposed to have the timeline
    window.onload = function() {
      var labelTestData = [
        {times: [{"starting_time": 1355752800000},{"starting_time": 1355755000000}, {"starting_time": 1355767900000, "ending_time": 1355774400000}]}       
      ];
      var uploadArray = [
        {times: []}
      ];
      var uploads=0;
      $.ajax({
        url: "getUploadData.php",
        type: "GET",
        //This should send the users ID
        data: "person_id=182",
        success: function (response) {
          if (response != ''){
             var uploadData=jQuery.parseJSON(response);
             jQuery.each(uploadData,function(key,value){
                var d=new Date(value);
                //Can add more data to this object to enable more interesting things later
                uploadArray[0]["times"][uploads]={"starting_time":d.getTime()};
                uploads++;
             });
             //Necessary to have ending time, otherwise tries to make infinite timeline which goes badly. Could also do when constructing timeline with the .ending(date) method
             if(uploads>0){
                uploadArray[0]["times"][uploads-1]["ending_time"]=new Date().getTime();
             }
             timelineHover();
           }
        }
      });
      
      var width = 800;

      function timelineHover() {
        if(uploadArray[0]["times"].length>0){
          var chart = d3.timeline()
          .width(width*3)
          .margin({left:70, right:50, top:0, bottom:0})
          .display("circle")
          .tickFormat({
            format: d3.time.format("%b %Y"),
            tickTime: d3.time.weeks,
            tickInterval: 4,
            tickSize: 10
          })
          .rotateTicks(20)
          .beginning(uploadArray[0]["times"][0]["starting_time"])
          .showTimeAxisTick()
          //TODO: Add hovering/clicking bringing up more data ie number of photos in upload, where the upload was from etc
          //This is the example of hovering that did some stuff

          .hover(function (d, i, datum) {
          // d is the current rendering object
          // i is the index during d3 rendering
          // datum is the id object
            var div = $('#hoverRes');
            var colors = chart.colors();
            div.find('.coloredDiv').css('background-color', colors(i))
            div.find('#name').text(datum.times.starting_time);
          })
          var svg = d3.select("#timeline").append("svg").attr("width", width)
              .datum(uploadArray).call(chart);
        }
        else{
          document.getElementById("timeline").innerHTML = "No uploads (yet)";
        }
      }
    }
  </script>
</head>
<body>
    <h3>Your uploads:</h3>
    <div id="timeline"></div>
    <div id="hoverRes">
      <div class="coloredDiv"></div>
      <div id="name"></div>
      <div id="scrolled_date"></div>
    </div>
</body>
</html>
